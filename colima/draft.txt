# 方法 1: 使用二進位檔安裝（推薦，更穩定）
ARCH="$(uname -m)"
URL=""
case "$ARCH" in
  x86_64|amd64)
    URL="https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64" ;;
  aarch64|arm64)
    URL="https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-arm64" ;;
  *)
    echo "Unsupported arch: $ARCH"; exit 1 ;;
esac
sudo mkdir -p /usr/local/bin
sudo curl -fsSL "$URL" -o /usr/local/bin/cloudflared
sudo chmod +x /usr/local/bin/cloudflared

# 方法 2: 使用 apt 安裝（需要先解決 DNS 問題）
# 
# DNS 問題解決方案：
# 1. 永久解決：修改 colima.yaml 加入自訂 DNS
#    network:
#      dns: ["1.1.1.1", "8.8.8.8", "100.100.100.100"]
#    然後重新啟動 colima: colima restart --profile nonprod
#
# 2. 臨時解決：在 VM 內手動設定 DNS
#    echo "nameserver 8.8.8.8" | sudo tee -a /etc/resolv.conf
#    echo "nameserver 1.1.1.1" | sudo tee -a /etc/resolv.conf
# 
# 3. 檢查 DNS 是否正常：
#    nslookup pkg.cloudflare.com
#    curl -I https://pkg.cloudflare.com
#
# 然後執行 apt 安裝：
# sudo mkdir -p --mode=0755 /usr/share/keyrings
# curl -fsSL https://pkg.cloudflare.com/cloudflare-main.gpg | sudo tee /usr/share/keyrings/cloudflare-main.gpg >/dev/null
# echo 'deb [signed-by=/usr/share/keyrings/cloudflare-main.gpg] https://pkg.cloudflare.com/cloudflared any main' | sudo tee /etc/apt/sources.list.d/cloudflared.list
# sudo apt-get update && sudo apt-get install cloudflared